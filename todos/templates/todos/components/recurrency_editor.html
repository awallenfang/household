{% load static%}
<script>
    let checks = document.getElementsByClassName("user-add-check")
    console.log(checks)

    for (let check of checks) {
        check.addEventListener("change", (event) => {
            userChecked(event)
        })
    }

    document.getElementById("rate-change-input").addEventListener("change", (event) => {
        rateChanged(event)
    })
</script>
<div class="floating-container">
    <div class="top-bar-container">
        <div></div>
        <a hx-get="{% url 'todos:empty'%}" 
        hx-target="#recurrent-block"
        hx-swap="innerHTML" 
        onclick="clearSelectedUsers()"
        class="close-icon-container">
            <img src="{% static 'todos/assets/close.svg' %}" class="close-icon">
        </a>
    </div>
    <div class="recurrency-editor-container">
        
        <div class="recurrency-list">
            {% for user in existing_order%}
                <div class="recurrency-item">
                    <p class="recurrency-user-name">{{user.auth_user.username}}</p>
                    <div cass="vertical-center-flex">
                        <a hx-post="{% url 'todos:recurrency_remove_position' todo.id forloop.counter0%}" 
                        hx-target="#recurrent-block"
                        hx-swap="innerHTML"
                        class="trash-container">
                            <img src="{% static 'todos/assets/trash.svg' %}" class="trashcan">
                        </a>
                        <img src="{% static 'todos/assets/drag.svg' %}" class="todo_drag_handle" draggable="false">
                    </div>
                </div>
            {%endfor%}
        </div>
        <div class="vertical-line" style="background-color: var(--mid-bg)"></div>
        <div class="recurrency-settings">
            <div class="add-user-container">
                <div class="user-list">
                    <div class="selectable-user">
                        <p>Empty space</p>
                        <input  class="user-add-check" type="checkbox" name="-1_checked" id="-1" change="userChecked(event)">
                    </div>
                    {% for user in available_users%}
                    <div class="selectable-user">
                        <p>{{user.auth_user.username}}</p>
                        <input  class="user-add-check" type="checkbox" name="{{user.id}}_checked" id="{{user.id}}" change="userChecked(event)">
                    </div>
                        
                    {% endfor %}
                </div>
                <a onclick="addSelectedUsers(event)" class="button" todo-id="{{todo.id}}">Add Selected Users</a>
            </div>
            <div class="horizontal-line" style="background-color: var(--mid-bg); margin: 0.5rem 0;"></div>
            <div class="recurrency-parameter">
                <p>Rate in days:</p>
                <input type="number" class="recurrency-rate" value="{{rate}}" min="1" id="rate-change-input" todo-id="{{todo.id}}">
            </div>
            <div class="button">Remove recurrency</div>
        </div>
        
    </div>
</div>
